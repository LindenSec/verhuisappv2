<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mijn Verhuischecklist</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <!-- React en ReactDOM laden via CDN -->
  <script src="https://unpkg.com/react@17/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@17/umd/react-dom.production.min.js"></script>
  <!-- Babel voor JSX transformatie -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    .hidden {
      display: none;
    }
    .completed {
      text-decoration: line-through;
      color: #6b7280;
    }
    .scrollable-tabs {
      overflow-x: auto;
      white-space: nowrap;
      -ms-overflow-style: none;
      scrollbar-width: none;
    }
    .scrollable-tabs::-webkit-scrollbar {
      display: none;
    }
    /* Custom CSS voor monochroom thema */
    .app-header {
      background-color: #1a1a1a;
    }
    .progress-bar-bg {
      background-color: #333333;
    }
    .progress-bar-fill {
      background-color: #ffffff;
    }
    .primary-button {
      background-color: #333333;
    }
    .primary-button:hover {
      background-color: #444444;
    }
    .secondary-button {
      background-color: #666666;
    }
    .secondary-button:hover {
      background-color: #777777;
    }
    .category-button {
      background-color: #333333;
    }
    .active-category {
      background-color: #ffffff;
      color: #000000;
    }
    .cost-tag {
      background-color: #eeeeee;
      color: #333333;
      font-size: 0.75rem;
      padding: 0.1rem 0.4rem;
      border-radius: 9999px;
      display: inline-flex;
      align-items: center;
    }
    .modal-backdrop {
      background-color: rgba(0, 0, 0, 0.7);
    }
    .toggle-switch {
      position: relative;
      display: inline-block;
      width: 50px;
      height: 24px;
    }
    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }
    .toggle-slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #ccc;
      transition: .4s;
      border-radius: 24px;
    }
    .toggle-slider:before {
      position: absolute;
      content: "";
      height: 16px;
      width: 16px;
      left: 4px;
      bottom: 4px;
      background-color: white;
      transition: .4s;
      border-radius: 50%;
    }
    input:checked + .toggle-slider {
      background-color: #333333;
    }
    input:checked + .toggle-slider:before {
      transform: translateX(26px);
    }
    .category-actions {
      opacity: 0;
      transition: opacity 0.2s;
    }
    .category-header:hover .category-actions {
      opacity: 1;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    // Destructuring React hooks
    const { useState, useEffect, useRef, useCallback } = React;

    // Basisstructuur voor categorieën, inclusief IKEA-integratie optie
    const categoryStructure = {
      "Woonkamer": { showIkea: true },
      "Keuken": { showIkea: true },
      "Badkamer": { showIkea: true },
      "Slaapkamer": { showIkea: true },
      "Werk-/Gamehoek": { showIkea: true },
      "Overig huishouden": { showIkea: true },
      "Nutsvoorzieningen & administratie": { showIkea: false },
      "Inventariseren": { showIkea: true }
    };

    // De oorspronkelijke verhuisdata definiëren
    const initialItems = [
      { id: 1, category: "Woonkamer", name: "Grote tv-kast (voor collectibles en tv)", completed: false, cost: 0 },
      { id: 2, category: "Woonkamer", name: "Bank (lounge of hoekbank)", completed: false, cost: 0 },
      { id: 3, category: "Woonkamer", name: "Salontafel", completed: false, cost: 0 },
      { id: 4, category: "Woonkamer", name: "Eettafeltje met stoelen", completed: false, cost: 0 },
      { id: 5, category: "Woonkamer", name: "Raambekleding (gordijnen of smart blinds)", completed: false, cost: 0 },
      { id: 6, category: "Woonkamer", name: "Vloerkleed (optioneel)", completed: false, cost: 0 },
      { id: 7, category: "Woonkamer", name: "Lampen (plafond, staand, sfeer)", completed: false, cost: 0 },
      
      { id: 8, category: "Werk-/Gamehoek", name: "Groot bureau (minimaal 2,5 meter)", completed: false, cost: 0 },
      { id: 9, category: "Werk-/Gamehoek", name: "Monitorarmen of standaarden", completed: false, cost: 0 },
      { id: 10, category: "Werk-/Gamehoek", name: "Kabelmanagement (goten, strips, ties)", completed: false, cost: 0 },
      { id: 11, category: "Werk-/Gamehoek", name: "Netwerkapparatuur (router, evt. mesh wifi)", completed: false, cost: 0 },
      { id: 12, category: "Werk-/Gamehoek", name: "Internetabonnement afsluiten", completed: false, cost: 0 },
      { id: 13, category: "Werk-/Gamehoek", name: "Stekkerdozen + overspanningsbeveiliging", completed: false, cost: 0 },
      { id: 14, category: "Werk-/Gamehoek", name: "Monitoren, toetsenborden, muizen", completed: false, cost: 0 },
      { id: 15, category: "Werk-/Gamehoek", name: "Verlichting (Hue strips of andere sfeerlicht)", completed: false, cost: 0 },
      
      { id: 16, category: "Keuken", name: "Vaatwastabletten", completed: false, cost: 0 },
      { id: 17, category: "Keuken", name: "Afwasmiddel en spons", completed: false, cost: 0 },
      { id: 18, category: "Keuken", name: "Afvalbak + vuilniszakken", completed: false, cost: 0 },
      { id: 19, category: "Keuken", name: "Pannen (koekenpan, steelpan, kookpannen)", completed: false, cost: 0 },
      { id: 20, category: "Keuken", name: "Bestek en bestekbak", completed: false, cost: 0 },
      { id: 21, category: "Keuken", name: "Borden, kommen, glazen, mokken", completed: false, cost: 0 },
      { id: 22, category: "Keuken", name: "Snijplank + messen", completed: false, cost: 0 },
      { id: 23, category: "Keuken", name: "Opscheplepels, spatels, garde", completed: false, cost: 0 },
      { id: 24, category: "Keuken", name: "Keukendoeken en theedoeken", completed: false, cost: 0 },
      { id: 25, category: "Keuken", name: "Opbergdozen / voorraadpotten", completed: false, cost: 0 },
      { id: 26, category: "Keuken", name: "Kruidenrek / kruiden", completed: false, cost: 0 },
      { id: 27, category: "Keuken", name: "Knoflookpers", completed: false, cost: 0 },
      { id: 28, category: "Keuken", name: "Vergiet", completed: false, cost: 0 },
      { id: 29, category: "Keuken", name: "Microvezeldoekjes", completed: false, cost: 0 },
      { id: 30, category: "Keuken", name: "Eetmaatje", completed: false, cost: 0 },
      { id: 31, category: "Keuken", name: "Maatbeker", completed: false, cost: 0 },
      { id: 32, category: "Keuken", name: "Maatlepels", completed: false, cost: 0 },
      { id: 33, category: "Keuken", name: "Pannenlappen", completed: false, cost: 0 },
      { id: 34, category: "Keuken", name: "Onderzetters", completed: false, cost: 0 },
      { id: 35, category: "Keuken", name: "Schalen", completed: false, cost: 0 },
      { id: 36, category: "Keuken", name: "Weegschaal", completed: false, cost: 0 },
      { id: 37, category: "Keuken", name: "Voorraad bakjes", completed: false, cost: 0 },
      
      { id: 38, category: "Badkamer", name: "Handdoeken (klein + groot)", completed: false, cost: 0 },
      { id: 39, category: "Badkamer", name: "Wasmand", completed: false, cost: 0 },
      { id: 40, category: "Badkamer", name: "Badmat", completed: false, cost: 0 },
      { id: 41, category: "Badkamer", name: "Toiletborstel + wc-rolhouder", completed: false, cost: 0 },
      { id: 42, category: "Badkamer", name: "Wc-papier", completed: false, cost: 0 },
      
      { id: 43, category: "Slaapkamer", name: "Bed + matras", completed: false, cost: 0 },
      { id: 44, category: "Slaapkamer", name: "Dekbed + kussens", completed: false, cost: 0 },
      { id: 45, category: "Slaapkamer", name: "Beddengoed (hoezen, lakens, slopen)", completed: false, cost: 0 },
      { id: 46, category: "Slaapkamer", name: "Nachtkastje(s)", completed: false, cost: 0 },
      { id: 47, category: "Slaapkamer", name: "Kledingkast of kledingrek", completed: false, cost: 0 },
      { id: 48, category: "Slaapkamer", name: "Raambekleding (verduisterend)", completed: false, cost: 0 },
      { id: 49, category: "Slaapkamer", name: "Extra dekens of plaids", completed: false, cost: 0 },
      
      { id: 50, category: "Overig huishouden", name: "Stofzuiger", completed: false, cost: 0 },
      { id: 51, category: "Overig huishouden", name: "Dweil + emmer", completed: false, cost: 0 },
      { id: 52, category: "Overig huishouden", name: "Schoonmaakmiddelen (allesreiniger, wc-, glas-)", completed: false, cost: 0 },
      { id: 53, category: "Overig huishouden", name: "Keukenrol, vaatdoekjes", completed: false, cost: 0 },
      { id: 54, category: "Overig huishouden", name: "Wasmiddel, wasverzachter", completed: false, cost: 0 },
      { id: 55, category: "Overig huishouden", name: "Wasrek", completed: false, cost: 0 },
      { id: 56, category: "Overig huishouden", name: "Strijkplank + strijkijzer (optioneel)", completed: false, cost: 0 },
      { id: 57, category: "Overig huishouden", name: "EHBO-set", completed: false, cost: 0 },
      
      { id: 58, category: "Nutsvoorzieningen & administratie", name: "Elektriciteit regelen", completed: false, cost: 0 },
      { id: 59, category: "Nutsvoorzieningen & administratie", name: "Water regelen", completed: false, cost: 0 },
      { id: 60, category: "Nutsvoorzieningen & administratie", name: "Warmte/koude via Linthorst Energy", completed: false, cost: 0 },
      { id: 61, category: "Nutsvoorzieningen & administratie", name: "Internetabonnement afsluiten", completed: false, cost: 0 },
      { id: 62, category: "Nutsvoorzieningen & administratie", name: "Inschrijven bij gemeente", completed: false, cost: 0 },
      { id: 63, category: "Nutsvoorzieningen & administratie", name: "Inboedelverzekering + aansprakelijkheidsverzekering", completed: false, cost: 0 },
      { id: 64, category: "Nutsvoorzieningen & administratie", name: "Post doorsturen (PostNL verhuisservice)", completed: false, cost: 0 },
      { id: 65, category: "Nutsvoorzieningen & administratie", name: "Adressen aanpassen bij bank, werk, DigiD etc.", completed: false, cost: 0 },
      
      { id: 66, category: "Inventariseren", name: "Inventariseren of er meer BILLY-kasten nodig zijn voor games", completed: false, cost: 0 }
    ];

    // Iconen als React componenten
    const HomeIcon = () => (
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
        <polyline points="9 22 9 12 15 12 15 22"/>
      </svg>
    );

    const EuroIcon = ({size = 16}) => (
      <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <line x1="12" y1="1" x2="12" y2="23"></line>
        <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
      </svg>
    );

    const CheckIcon = () => (
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <polyline points="20 6 9 17 4 12"/>
      </svg>
    );

    const XIcon = () => (
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <line x1="18" y1="6" x2="6" y2="18"/>
        <line x1="6" y1="6" x2="18" y2="18"/>
      </svg>
    );

    const CheckCircleIcon = ({className}) => (
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
        <circle cx="12" cy="12" r="10"></circle>
        <path d="m9 12 2 2 4-4"></path>
      </svg>
    );

    const CircleIcon = ({className}) => (
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
        <circle cx="12" cy="12" r="10"></circle>
      </svg>
    );

    const ShoppingCartIcon = ({size = 18}) => (
      <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <circle cx="8" cy="21" r="1"></circle>
        <circle cx="19" cy="21" r="1"></circle>
        <path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12"></path>
      </svg>
    );

    const ArrowUpIcon = () => (
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <line x1="12" y1="19" x2="12" y2="5"></line>
        <polyline points="5 12 12 5 19 12"></polyline>
      </svg>
    );

    const SettingsIcon = ({size = 18}) => (
      <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <circle cx="12" cy="12" r="3"></circle>
        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
      </svg>
    );

    const EditIcon = ({size = 18}) => (
      <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
      </svg>
    );

    // Hoofdapplicatie
    const App = () => {
      // State voor de app
      const [items, setItems] = useState([]);
      const [filterCategory, setFilterCategory] = useState('Alle');
      const [showCompleted, setShowCompleted] = useState(true);
      const [showAddForm, setShowAddForm] = useState(false);
      const [showCategoryForm, setShowCategoryForm] = useState(false);
      const [showEditCategoryForm, setShowEditCategoryForm] = useState(false);
      const [isScrolled, setIsScrolled] = useState(false);
      const [currentItemForCost, setCurrentItemForCost] = useState(null);
      const [newItemText, setNewItemText] = useState('');
      const [newItemCategory, setNewItemCategory] = useState('');
      const [costValue, setCostValue] = useState('');
      const [pendingCostItems, setPendingCostItems] = useState([]);
      const [newCategoryName, setNewCategoryName] = useState('');
      const [newCategoryShowIkea, setNewCategoryShowIkea] = useState(true);
      const [categorySettings, setCategorySettings] = useState({...categoryStructure});
      const [editingCategory, setEditingCategory] = useState(null);

      // Refs
      const costInputRef = useRef(null);
      
      // Items laden bij het starten
      useEffect(() => {
        const savedItems = localStorage.getItem('verhuisItems');
        if (savedItems) {
          setItems(JSON.parse(savedItems));
        } else {
          setItems(initialItems);
        }

        // Categorie-instellingen laden
        const savedCategorySettings = localStorage.getItem('verhuisCategorySettings');
        if (savedCategorySettings) {
          setCategorySettings(JSON.parse(savedCategorySettings));
        }
        
        // Scroll handler
        const handleScroll = () => {
          setIsScrolled(window.scrollY > 100);
        };
        
        window.addEventListener('scroll', handleScroll);
        return () => window.removeEventListener('scroll', handleScroll);
      }, []);
      
      // Items opslaan bij wijzigingen
      useEffect(() => {
        if (items.length > 0) {
          localStorage.setItem('verhuisItems', JSON.stringify(items));
        }
      }, [items]);

      // Categorie-instellingen opslaan bij wijzigingen
      useEffect(() => {
        localStorage.setItem('verhuisCategorySettings', JSON.stringify(categorySettings));
      }, [categorySettings]);
      
      // Focus op kosteninvoerveld wanneer dialoog wordt geopend
      useEffect(() => {
        if (currentItemForCost && costInputRef.current) {
          costInputRef.current.focus();
        }
      }, [currentItemForCost]);
      
      // Berekenen totale voortgang
      const calculateProgress = () => {
        if (items.length === 0) return 0;
        const completedCount = items.filter(item => item.completed).length;
        return Math.round((completedCount / items.length) * 100);
      };
      
      // Berekenen totale kosten
      const calculateTotalCost = () => {
        return items.reduce((total, item) => total + (item.cost || 0), 0);
      };
      
      // Formatteren van valuta
      const formatCurrency = (amount) => {
        return '€' + parseFloat(amount).toFixed(2).replace('.', ',');
      };
      
      // Filteren van items op basis van categorie en voltooiingsstatus
      const filteredItems = items.filter(item => {
        const categoryMatch = filterCategory === 'Alle' || item.category === filterCategory;
        const completionMatch = showCompleted || !item.completed;
        return categoryMatch && completionMatch;
      });
      
      // Items groeperen per categorie
      const groupItemsByCategory = () => {
        const grouped = {};
        filteredItems.forEach(item => {
          if (!grouped[item.category]) {
            grouped[item.category] = [];
          }
          grouped[item.category].push(item);
        });
        return grouped;
      };
      
      // Alle unieke categorieën verkrijgen
      const getCategories = () => {
        return [...new Set(items.map(item => item.category))];
      };
      
      // Item status wijzigen (afvinken/ontvinken)
      const toggleItemCompletion = (id) => {
        const item = items.find(item => item.id === id);
        if (!item) return;
        
        // Als item wordt afgevinkt, kosten dialoog tonen
        if (!item.completed) {
          // Item markeren als compleet
          setItems(items.map(item => 
            item.id === id ? { ...item, completed: true } : item
          ));
          
          // Kosten dialoog tonen
          setCurrentItemForCost(item);
          setCostValue('');
        } else {
          // Als item wordt uitgevinkt, kosten resetten
          setItems(items.map(item => 
            item.id === id ? { ...item, completed: false, cost: 0 } : item
          ));
        }
      };
      
      // Kosten opslaan
      const saveCost = () => {
        if (!currentItemForCost) return;
        
        const cost = parseFloat(costValue) || 0;
        
        setItems(items.map(item => 
          item.id === currentItemForCost.id ? { ...item, cost } : item
        ));
        
        closeAndContinueCostDialog();
      };
      
      // Kosten overslaan en doorgaan naar volgende item
      const skipCost = () => {
        closeAndContinueCostDialog();
      };
      
      // Kosten dialoog sluiten en verder gaan met volgende item
      const closeAndContinueCostDialog = () => {
        setCurrentItemForCost(null);
        setCostValue('');
        
        // Controleer of er een wachtrij is met items voor kosteninvoer
        if (pendingCostItems.length > 0) {
          const nextItemId = pendingCostItems[0];
          const nextItem = items.find(item => item.id === nextItemId);
          
          setPendingCostItems(pendingCostItems.slice(1));
          
          if (nextItem) {
            setCurrentItemForCost(nextItem);
          }
        }
      };
      
      // Alle items in een categorie afvinken
      const completeCategory = (category) => {
        const incompleteCategoryItems = items.filter(item => 
          item.category === category && !item.completed
        );
        
        if (incompleteCategoryItems.length === 0) return;
        
        // Markeer alle items in de categorie als voltooid
        setItems(items.map(item => 
          item.category === category ? { ...item, completed: true } : item
        ));
        
        // Als er één item was, direct vragen om kosten
        if (incompleteCategoryItems.length === 1) {
          setCurrentItemForCost(incompleteCategoryItems[0]);
        } 
        // Als er meerdere items zijn, eerste tonen en rest in wachtrij zetten
        else if (incompleteCategoryItems.length > 1) {
          setCurrentItemForCost(incompleteCategoryItems[0]);
          setPendingCostItems(incompleteCategoryItems.slice(1).map(item => item.id));
        }
      };
      
      // Item verwijderen
      const deleteItem = (id) => {
        setItems(items.filter(item => item.id !== id));
      };
      
      // Nieuw item toevoegen
      const addItem = () => {
        if (newItemText.trim() === '' || newItemCategory.trim() === '') return;
        
        const newId = items.length > 0 ? Math.max(...items.map(item => item.id)) + 1 : 1;
        
        const newItem = {
          id: newId,
          category: newItemCategory,
          name: newItemText,
          completed: false,
          cost: 0
        };
        
        setItems([...items, newItem]);
        setNewItemText('');
        setShowAddForm(false);
      };
      
      // Nieuwe categorie toevoegen
      const addCategory = () => {
        if (newCategoryName.trim() === '') return;
        
        // Controle of categorie al bestaat
        if (getCategories().includes(newCategoryName)) {
          alert(`Categorie "${newCategoryName}" bestaat al!`);
          return;
        }
        
        // Categorie-instellingen bijwerken
        setCategorySettings({
          ...categorySettings,
          [newCategoryName]: { showIkea: newCategoryShowIkea }
        });
        
        // Standaard eerste item in nieuwe categorie
        const newId = items.length > 0 ? Math.max(...items.map(item => item.id)) + 1 : 1;
        
        const newItem = {
          id: newId,
          category: newCategoryName,
          name: "Nieuw item",
          completed: false,
          cost: 0
        };
        
        setItems([...items, newItem]);
        setNewCategoryName('');
        setNewCategoryShowIkea(true);
        setShowCategoryForm(false);
      };

      // Bestaande categorie bewerken
      const editCategory = (category) => {
        setEditingCategory(category);
        setShowEditCategoryForm(true);
      };

      // Categorie-instellingen updaten
      const updateCategory = () => {
        if (!editingCategory) return;

        // Controleer of de nieuwe naam al bestaat (behalve als het dezelfde naam is)
        const newName = document.getElementById('editCategoryName').value.trim();
        const showIkea = document.getElementById('editCategoryShowIkea').checked;

        if (newName === '') {
          alert('Categorienaam mag niet leeg zijn!');
          return;
        }

        if (newName !== editingCategory && getCategories().includes(newName)) {
          alert(`Categorie "${newName}" bestaat al!`);
          return;
        }

        // Update categorienaam in items
        if (newName !== editingCategory) {
          setItems(items.map(item => 
            item.category === editingCategory ? { ...item, category: newName } : item
          ));
        }

        // Update categorie-instellingen
        const updatedSettings = {...categorySettings};
        
        // Verwijder oude sleutel
        if (newName !== editingCategory) {
          const { [editingCategory]: _, ...rest } = updatedSettings;
          updatedSettings[newName] = { showIkea };
          setCategorySettings(rest);
        } else {
          updatedSettings[editingCategory] = { showIkea };
          setCategorySettings(updatedSettings);
        }

        setShowEditCategoryForm(false);
        setEditingCategory(null);
      };
      
      // IKEA zoekfunctie
      const searchIkea = (item) => {
        const searchTerm = getSearchTerms(item);
        window.open(`https://www.ikea.com/nl/nl/search/?q=${encodeURIComponent(searchTerm)}`, '_blank');
      };
      
      // Controleer of IKEA-zoekfunctie beschikbaar is voor deze categorie
      const hasIkeaIntegration = (category) => {
        return categorySettings[category]?.showIkea ?? true;
      };
      
      // Zoektermen genereren voor IKEA
      const getSearchTerms = (item) => {
        // Woorden extraheren uit de itemnaam
        const words = item.name.split(/[\s\(\)]+/);
        
        // Bepaalde woorden uitsluiten
        const excludedWords = ['voor', 'met', 'en', 'of', 'andere', 'evt.', 'etc.', 'kleine', 'grote'];
        
        // Woorden filteren
        let searchTerms = words.filter(word => 
          word.length > 2 && 
          !excludedWords.includes(word.toLowerCase())
        );
        
        // Categorie-specifieke termen
        const categoryTerms = {
          "Woonkamer": ["kast", "bank", "tafel", "gordijn"],
          "Keuken": ["keuken", "bestek", "pan", "opberg"],
          "Badkamer": ["badkamer", "handdoek", "douche"],
          "Slaapkamer": ["bed", "matras", "kussen", "kast"],
          "Werk-/Gamehoek": ["bureau", "stoel", "kabel", "lamp"],
        };
        
        // Als er weinig zoektermen zijn, categorie-specifieke termen toevoegen
        if (searchTerms.length < 2 && categoryTerms[item.category]) {
          searchTerms = [...searchTerms, ...categoryTerms[item.category]];
        }
        
        // Terugvallen op categorie als er geen termen zijn
        if (searchTerms.length === 0) {
          return item.category;
        }
        
        return searchTerms.slice(0, 3).join(' ');
      };
      
      // Scroll naar boven
      const scrollToTop = () => {
        window.scrollTo({ top: 0, behavior: 'smooth' });
      };
      
      // Categoriefilters component
      const CategoryFilters = () => (
        <div className="mt-3 flex scrollable-tabs pb-2">
          <button
            onClick={() => setFilterCategory('Alle')}
            className={`whitespace-nowrap px-3 py-1 mr-2 rounded-full text-sm ${
              filterCategory === 'Alle' ? 'active-category' : 'category-button text-white'
            }`}
          >
            Alle
          </button>
          
          {getCategories().map(category => (
            <button
              key={category}
              onClick={() => setFilterCategory(category)}
              className={`whitespace-nowrap px-3 py-1 mr-2 rounded-full text-sm ${
                filterCategory === category ? 'active-category' : 'category-button text-white'
              }`}
            >
              {category}
            </button>
          ))}
          
          <button
            onClick={() => setShowCategoryForm(true)}
            className="whitespace-nowrap px-3 py-1 mr-2 rounded-full text-sm bg-green-600 text-white"
          >
            + Categorie
          </button>
        </div>
      );
      
      // ItemList component
      const ItemList = () => {
        const groupedItems = groupItemsByCategory();
        
        return (
          <div>
            {Object.entries(groupedItems).map(([category, categoryItems]) => (
              <div key={category} className="mb-6">
                <div className="flex justify-between items-center mb-2 category-header">
                  <h2 className="text-lg font-semibold text-gray-800">{category}</h2>
                  <div className="flex items-center">
                    <div className="category-actions mr-3">
                      <button 
                        onClick={() => editCategory(category)}
                        className="text-gray-500 hover:text-gray-700 mr-2"
                        title="Bewerk categorie"
                      >
                        <EditIcon size={16} />
                      </button>
                    </div>
                    <button 
                      onClick={() => completeCategory(category)}
                      className="text-xs primary-button text-white px-2 py-1 rounded"
                    >
                      Alles afvinken
                    </button>
                  </div>
                </div>
                
                <div className="bg-white rounded-lg shadow-md overflow-hidden">
                  {categoryItems.map(item => (
                    <div 
                      key={item.id} 
                      className={`flex items-center p-3 border-b ${
                        item.completed ? 'bg-gray-50' : ''
                      }`}
                    >
                      <button
                        onClick={() => toggleItemCompletion(item.id)}
                        className="mr-3 flex-shrink-0"
                      >
                        {item.completed ? (
                          <CheckCircleIcon className="text-green-500" />
                        ) : (
                          <CircleIcon className="text-gray-400" />
                        )}
                      </button>
                      
                      <div className="flex-grow flex flex-col">
                        <span className={item.completed ? 'completed' : 'text-gray-800'}>
                          {item.name}
                        </span>
                        
                        {item.cost > 0 && (
                          <span className="cost-tag mt-1 inline-block">
                            <EuroIcon size={12} className="mr-1" />
                            {formatCurrency(item.cost)}
                          </span>
                        )}
                      </div>
                      
                      {hasIkeaIntegration(category) && (
                        <button
                          onClick={() => searchIkea(item)}
                          className="text-blue-500 ml-2"
                          title="Zoek op IKEA"
                        >
                          <ShoppingCartIcon />
                        </button>
                      )}
                      
                      <button
                        onClick={() => deleteItem(item.id)}
                        className="text-red-500 ml-2"
                      >
                        <XIcon />
                      </button>
                    </div>
                  ))}
                </div>
              </div>
            ))}
          </div>
        );
      };
      
      // Weergave van kostentoevoegingsdialoog
      const CostDialog = () => {
        if (!currentItemForCost) return null;
        
        return (
          <div className="fixed inset-0 modal-backdrop flex items-center justify-center z-50">
            <div className="bg-white p-4 rounded-lg shadow-md max-w-md w-full mx-4">
              <h3 className="text-lg font-semibold mb-3">Kosten toevoegen</h3>
              <p className="mb-3 text-sm">Item: {currentItemForCost.name}</p>
              
              <div className="mb-3">
                <label className="block text-gray-700 mb-1 text-sm">Prijs (€)</label>
                <input
                  ref={costInputRef}
                  type="number"
                  step="0.01"
                  min="0"
                  value={costValue}
                  onChange={(e) => setCostValue(e.target.value)}
                  onKeyPress={(e) => e.key === 'Enter' && saveCost()}
                  className="w-full p-2 border rounded"
                  placeholder="0,00"
                />
              </div>
              
              <div className="flex space-x-2">
                <button
                  onClick={saveCost}
                  className="primary-button text-white px-4 py-2 rounded flex-grow"
                >
                  Opslaan
                </button>
                <button
                  onClick={skipCost}
                  className="secondary-button text-white px-4 py-2 rounded"
                >
                  Overslaan
                </button>
              </div>
            </div>
          </div>
        );
      };
      
      // Weergave van categorietoevoegingsdialoog
      const CategoryForm = () => {
        if (!showCategoryForm) return null;
        
        return (
          <div className="fixed inset-0 modal-backdrop flex items-center justify-center z-50">
            <div className="bg-white p-4 rounded-lg shadow-md max-w-md w-full mx-4">
              <h3 className="text-lg font-semibold mb-3">Nieuwe categorie toevoegen</h3>
              
              <div className="mb-3">
                <label className="block text-gray-700 mb-1 text-sm">Naam categorie</label>
                <input
                  type="text"
                  value={newCategoryName}
                  onChange={(e) => setNewCategoryName(e.target.value)}
                  onKeyPress={(e) => e.key === 'Enter' && addCategory()}
                  className="w-full p-2 border rounded"
                  placeholder="Bijvoorbeeld: Huisdieren"
                />
              </div>
              
              <div className="mb-3">
                <label className="flex items-center text-gray-700 text-sm">
                  <span className="mr-2">IKEA-integratie inschakelen</span>
                  <div className="toggle-switch">
                    <input 
                      type="checkbox" 
                      checked={newCategoryShowIkea} 
                      onChange={(e) => setNewCategoryShowIkea(e.target.checked)} 
                    />
                    <span className="toggle-slider"></span>
                  </div>
                </label>
                <p className="mt-1 text-gray-500 text-xs">
                  Schakel uit voor categorieën zoals nutsvoorzieningen waar geen IKEA-producten voor nodig zijn.
                </p>
              </div>
              
              <div className="flex space-x-2">
                <button
                  onClick={addCategory}
                  className="primary-button text-white px-4 py-2 rounded flex-grow"
                >
                  Toevoegen
                </button>
                <button
                  onClick={() => setShowCategoryForm(false)}
                  className="secondary-button text-white px-4 py-2 rounded"
                >
                  Annuleren
                </button>
              </div>
            </div>
          </div>
        );
      };

      // Weergave van categorie-bewerkingsdialoog
      const EditCategoryForm = () => {
        if (!showEditCategoryForm || !editingCategory) return null;
        
        const currentShowIkea = categorySettings[editingCategory]?.showIkea ?? true;
        
        return (
          <div className="fixed inset-0 modal-backdrop flex items-center justify-center z-50">
            <div className="bg-white p-4 rounded-lg shadow-md max-w-md w-full mx-4">
              <h3 className="text-lg font-semibold mb-3">Categorie bewerken</h3>
              
              <div className="mb-3">
                <label className="block text-gray-700 mb-1 text-sm">Naam categorie</label>
                <input
                  id="editCategoryName"
                  type="text"
                  defaultValue={editingCategory}
                  className="w-full p-2 border rounded"
                  placeholder="Categorienaam"
                />
              </div>
              
              <div className="mb-3">
                <label className="flex items-center text-gray-700 text-sm">
                  <span className="mr-2">IKEA-integratie inschakelen</span>
                  <div className="toggle-switch">
                    <input 
                      id="editCategoryShowIkea"
                      type="checkbox" 
                      defaultChecked={currentShowIkea} 
                    />
                    <span className="toggle-slider"></span>
                  </div>
                </label>
                <p className="mt-1 text-gray-500 text-xs">
                  Schakel uit voor categorieën zoals nutsvoorzieningen waar geen IKEA-producten voor nodig zijn.
                </p>
              </div>
              
              <div className="flex space-x-2">
                <button
                  onClick={updateCategory}
                  className="primary-button text-white px-4 py-2 rounded flex-grow"
                >
                  Opslaan
                </button>
                <button
                  onClick={() => {
                    setShowEditCategoryForm(false);
                    setEditingCategory(null);
                  }}
                  className="secondary-button text-white px-4 py-2 rounded"
                >
                  Annuleren
                </button>
              </div>
            </div>
          </div>
        );
      };
      
      // Weergave van itemtoevoegingsdialoog
      const AddItemForm = () => {
        if (!showAddForm) return null;
        
        return (
          <div className="fixed inset-0 modal-backdrop flex items-center justify-center z-50">
            <div className="bg-white p-4 rounded-lg shadow-md max-w-md w-full mx-4">
              <h3 className="text-lg font-semibold mb-3">Nieuw item toevoegen</h3>
              
              <div className="mb-3">
                <label className="block text-gray-700 mb-1 text-sm">Categorie</label>
                <select
                  value={newItemCategory}
                  onChange={(e) => setNewItemCategory(e.target.value)}
                  className="w-full p-2 border rounded"
                >
                  <option value="">Selecteer een categorie</option>
                  {getCategories().map(category => (
                    <option key={category} value={category}>{category}</option>
                  ))}
                </select>
              </div>
              
              <div className="mb-3">
                <label className="block text-gray-700 mb-1 text-sm">Item naam</label>
                <input
                  type="text"
                  value={newItemText}
                  onChange={(e) => setNewItemText(e.target.value)}
                  onKeyPress={(e) => e.key === 'Enter' && addItem()}
                  className="w-full p-2 border rounded"
                  placeholder="Bijvoorbeeld: Gordijnen ophangen"
                />
              </div>
              
              <div className="flex space-x-2">
                <button
                  onClick={addItem}
                  className="primary-button text-white px-4 py-2 rounded flex-grow"
                >
                  Toevoegen
                </button>
                <button
                  onClick={() => setShowAddForm(false)}
                  className="secondary-button text-white px-4 py-2 rounded"
                >
                  Annuleren
                </button>
              </div>
            </div>
          </div>
        );
      };
      
      return (
        <div className="bg-gray-100 min-h-screen pb-16">
          {/* Header met titel en voortgang */}
          <header className="app-header text-white p-4 sticky top-0 z-10 shadow-md">
            <div className="max-w-md mx-auto">
              <div className="flex justify-between items-center">
                <h1 className="text-xl font-bold flex items-center">
                  <HomeIcon className="mr-2" /> Verhuischecklist
                </h1>
                <div className="flex items-center">
                  <div className="mr-3 text-sm flex items-center">
                    <EuroIcon className="mr-1" />
                    <span>{formatCurrency(calculateTotalCost())}</span>
                  </div>
                  <button 
                    onClick={() => setShowCompleted(!showCompleted)}
                    className="primary-button p-2 rounded-full"
                  >
                    {showCompleted ? <CheckIcon /> : <XIcon />}
                  </button>
                </div>
              </div>
              
              {/* Voortgangsbalk */}
              <div className="mt-3 progress-bar-bg rounded-full h-4 overflow-hidden">
                <div 
                  className="progress-bar-fill h-full transition-all duration-500 ease-out"
                  style={{ width: `${calculateProgress()}%` }}
                ></div>
              </div>
              <div className="text-center text-xs mt-1">
                {calculateProgress()}% voltooid
              </div>
              
              {/* Categorie filter */}
              <CategoryFilters />
            </div>
          </header>

          {/* Hoofdinhoud */}
          <main className="max-w-md mx-auto p-4">
            <ItemList />
          </main>

          {/* Zwevende actieknoppen */}
          <div className="fixed bottom-4 right-4 flex flex-col space-y-2">
            {isScrolled && (
              <button
                onClick={scrollToTop}
                className="secondary-button text-white p-3 rounded-full shadow-lg"
              >
                <ArrowUpIcon />
              </button>
            )}
            
            <button
              onClick={() => setShowAddForm(true)}
              className="primary-button text-white p-4 rounded-full shadow-lg text-2xl"
            >
              +
            </button>
          </div>

          {/* Dialogen */}
          <CostDialog />
          <AddItemForm />
          <CategoryForm />
          <EditCategoryForm />
        </div>
      );
    };

    // App renderen
    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>
